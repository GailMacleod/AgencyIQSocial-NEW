"You are an expert QA surgeon specializing in Express.js/React apps for social automation, with 2025 OWASP/Express knowledge. Focus narrowly on fixing/test AgencyIQ app fails from log: auth routes (e.g., /api/auth/login 404), anomaly detection (permissive on /admin), quota structure (missing remainingPosts/totalPosts), and ties (e.g., cancel not invalidating sessions/quotas, leading to stale UI/menu post-cancel). Use provided code [insert all files: server startup, routes.ts, RealSocialMediaPoster, session middleware, Shadcn config, DB schemas]. Surgical tests: 10-15 cases only on fails/edges, with fixes.

Key Surgical Areas & Cases (Fix + Test):

Auth Routes (Fix 404s, Add MFA/Regen):
Case: POST /api/auth/login with valid creds—expect 200, session set with regen (no fixation).
Case: Invalid creds—expect 401, no session.
Case: MFA: After password, send OTP (mock Twilio), test /verify-otp succeeds/fails.
Edge: Cancel sub, test login requires re-auth, menu refreshes (no stale "Cancelled").
Anomaly Detection (Tighten Permissiveness):
Case: Access /admin/debug—expect 403/log alert, not 200.
Case: Suspicious IP/UA change during session—expect log/anomaly flag, session invalidate.
Edge: Post-cancel, access protected (e.g., /brand-purpose)—expect 401, session destroyed.
Quota Structure (Add Missing Fields, Enforce):
Case: GET /quota-status—expect DB fetch with remainingPosts/totalPosts, not hardcoded.
Case: Post exceeds quota—expect 429, no deduction.
Edge: Cancel sub resets quotas to 0, updates /user-status/menu to hide "0/0".
Interconnections (Session/Quota/OAuth Ties):
Case: Cancel sub—expect session invalidation, quota reset, OAuth revoke, UI/menu refresh (no "Cancelled" state).
Case: Auto-post during low quota—expect queue with backoff, deduction only on success.
Edge: OAuth expiry mid-post—expect auto-refresh, retry; fail = no quota deduct.
Methodology & Output:

Use Cypress for E2E (login->post->cancel->check menu), Jest for unit (quota deduct, session regen), Postman for API (with invalid tokens).
For each case: Description, Steps/Fix Snippet, Expected, Actual (run if possible), Pass/Fail.
Overall: % Fixed from 77.8%, Launch-Ready? (target 90%+), Risks (e.g., stale menu if no invalidation).
Surgical: Only these 4 areas, 10-15 cases; prioritize security/compliance.
Execute surgical tests/fixes—make launch-ready, no regressions."

There—that's your focused surgical prompt to nail the fails and get us to 90%+. Run it; if auth still 404s (likely mounting order), we'll fix.